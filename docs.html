<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FAIF API — Docs Interativo</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    :root { --c-dark: #1a1a1a; --c-darker: #0b1220; --c-medium: #2a2a2a; --c-orange: #ff6b35; --c-blue: #dbeafe; }
    body { background: var(--c-dark); font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji"; }
    .sidebar { max-height: 90vh; overflow-y: auto; }
    .panel-left { background: var(--c-medium); color: #fff; padding: 1.25rem; border-radius: .5rem; min-height: 90vh; }
    .response-sample { background: var(--c-dark); color: var(--c-blue); padding: .75rem; border-radius:.375rem; font-family: "Roboto Mono", monospace; font-size:.9rem; overflow:auto; max-height: 40vh; }
    .try-btn { background: var(--c-darker); color:var(--c-orange); border: 1px solid var(--c-orange); font-weight:700; }
    .try-btn:hover { background: var(--c-orange); color: var(--c-darker); }
    .method-get { background:#198754; color:#fff; padding:.15rem .6rem; border-radius:.3rem; font-size:.8rem; font-family: monospace; }
    .doc-card { background: var(--c-dark); border-radius:.5rem; padding: 1rem; }
    .muted-small { color: rgba(255,255,255,0.7); font-size:.9rem; }
    pre.json { margin:0; white-space:pre-wrap; word-break:break-word; }
    .param-type { font-weight:700; color: var(--c-orange); font-family: monospace; }
    .curl-sample { background:var(--c-darker); color:var(--c-orange); padding:.75rem; border-radius:.25rem; font-family:monospace; font-size:.85rem; overflow:auto; white-space: pre; }
    .note { font-size:.9rem; color:var(--c-blue); background: rgba(219, 234, 254, 0.1); padding: .75rem; border-radius: .375rem; }
    .list-group-item-action { transition: background-color 0.2s ease-in-out; }
    .accordion-button { background: #333; color: white; }
    .accordion-button:not(.collapsed) { background: #444; color: white; }
    .accordion-button::after { filter: invert(1) grayscale(100%); }
    .list-group-item { background-color: var(--c-dark); border-color: var(--c-medium); color: white; }
    .list-group-item-action:hover { background-color: var(--c-medium); }
    .group-header { font-weight: bold; color: var(--c-orange); margin-top: 1rem; margin-bottom: 0.5rem; padding-left: 0.5rem; }
  </style>
</head>
<body>

<div class="container-fluid py-4">
  <div class="row gx-4">
    <div class="col-lg-5">
      <div id="interactionPanel" class="panel-left sticky-top">
        <div class="d-flex justify-content-between mb-2 align-items-start">
          <div>
            <div class="small muted-small">ENDPOINT</div>
            <h5 id="panelEndpoint" class="mb-0 text-break">/health</h5>
          </div>
          <div class="text-end">
            <div id="methodBadge" class="method-get">GET</div>
          </div>
        </div>
        <div id="endpointDescription" class="small muted-small mb-3">Verifica o status da API.</div>

        <div class="doc-card mb-3">
          <div class="section-title mb-2"><strong>Request</strong></div>
          <div id="requiredHeaders" class="note mb-3" style="display: none;"></div>
          <div id="paramAccordion" class="accordion mb-2"></div>
        </div>

        <div class="doc-card mb-3">
            <div class="d-flex justify-content-between align-items-center">
             <div><button id="tryBtn" class="btn try-btn btn-sm">Try it</button></div>
             <div class="text-end"><div id="statusBadge"></div></div>
            </div>
        </div>

        <div class="mb-3">
          <div class="d-flex justify-content-between align-items-center">
            <strong>Response</strong>
            <div id="meta" class="muted-small">Status: — | Time: — ms</div>
          </div>
          <div id="responseArea" class="response-sample mt-2"><pre id="responseJson" class="json">Selecione uma rota e clique em "Try it".</pre></div>
        </div>

        <div>
          <div class="section-title"><strong>cURL Sample</strong></div>
          <div id="curlSample" class="curl-sample mt-2">—</div>
        </div>
      </div>
    </div>

    <div class="col-lg-7">
      <div class="sidebar p-3" style="background: var(--c-medium); border-radius: .5rem;">
        <div class="d-flex align-items-center justify-content-between mb-3">
          <div>
            <h4 class="mb-0 text-white">FAIF API</h4>
            <div class="text-white-50 small">Documentação interativa para a API do FAIF.</div>
          </div>
          <div class="text-end">
            <div class="mb-1"><small class="text-white-50">Repositório da API</small></div>
            <div class="small"><a href="https://github.com/vichsort/FAIFApi" target="_blank" class="text-warning">GitHub</a></div>
          </div>
        </div>

        <div class="mb-3 doc-card">
          <label class="form-label small"><strong>Headers Customizados</strong></label>
          <div class="input-group input-group-sm mb-2">
            <input id="authHeaderKey" class="form-control" placeholder="Header (ex: chave-api-dados)">
            <input id="authHeaderValue" class="form-control" placeholder="Valor (ex: SEU_TOKEN)">
            <button id="addHeaderBtn" class="btn btn-outline-warning btn-sm">Adicionar</button>
          </div>
          <div id="customHeadersList" class="small text-white-50"></div>
        </div>
        <hr class="border-secondary">
        <div id="routesList" class="list-group"></div>
        <hr class="my-3 border-secondary">
        <div class="small text-white-50">
            <p>Este documento interativo permite testar a API FAIFApi em tempo real. As chamadas são feitas para o endereço configurado em <code>BASE_URL</code> no código-fonte.</p>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
// ===================================================================================
//  CONFIGURAÇÃO DA API E ENDPOINTS
//  Esta seção contém a definição de todos os endpoints da FAIF API.
// ===================================================================================

const BASE_URL = 'http://localhost:5000';

const API_ENDPOINTS = [
  {
    groupName: 'Geral',
    routes: [
      {
        utilidade: "Health Check",
        method: "GET",
        path: "/health",
        description: "Verifica a saúde e o tempo de atividade da API.",
        params: [],
        responseSample: { ok: true, data: { status: "ok", uptime_seconds: 123.45 } },
        errorSample: { ok: false, error: { code: "HEALTH_FAIL", message: "Health check failed.", details: null } }
      }
    ]
  },
  {
    groupName: 'Consultas Gerais',
    routes: [
      {
        utilidade: "Consulta de CEP",
        method: "GET",
        path: "/faif/cep/{cep}",
        description: "Consulta um endereço a partir de um CEP.",
        params: [{ name: "cep", in: "path", type: "string", example: "01001000", required: true }],
        responseSample: { ok: true, data: { cep: "string", state: "string", city: "string", neighborhood: "string", street: "string", service: "string" } },
        errorSample: { ok: false, error: { code: "CEP_NOT_FOUND", message: "CEP não encontrado.", details: "..." } }
      },
      {
        utilidade: "Consulta de CNPJ",
        method: "GET",
        path: "/faif/cnpj/{cnpj}",
        description: "Consulta dados de uma empresa a partir de um CNPJ e retorna os dados normalizados.",
        params: [{ name: "cnpj", in: "path", type: "string", example: "06990590000123", required: true }],
        responseSample: { ok: true, data: { cnpj: "string", nome: "string", fantasia: "string", natureza_juridica: "string", porte: "string", abertura: "string", atividade_principal: [{ code: "string", text: "string" }], atividades_secundarias: [{ code: "string", text: "string" }], logradouro: "string", numero: "string", complemento: "string", bairro: "string", municipio: "string", uf: "string", cep: "string", situacao: "string", data_situacao: "string", capital_social: "string", motivo_situacao: "string", situacao_especial: "string", data_situacao_especial: "string", qsa: [{ qual: "string", nome: "string" }] } },
        errorSample: { ok: false, error: { code: "CNPJ_NOT_FOUND", message: "CNPJ não encontrado.", details: "..." } }
      },
      {
        utilidade: "Busca de Deputados",
        method: "GET",
        path: "/faif/deputados/{deputado}",
        description: "Busca deputados federais por nome e retorna uma lista normalizada.",
        params: [{ name: "deputado", in: "path", type: "string", example: "tiririca", required: true }],
        responseSample: { ok: true, data: [{ nome: "string", email: "string", id: 0, siglaPartido: "string", siglaUf: "string", urlFoto: "string" }] },
        errorSample: { ok: false, error: { code: "DEPUTADO_NOT_FOUND", message: "Deputado(s) não encontrado(s).", details: "..." } }
      },
      {
        utilidade: "Pesquisa no IBGE",
        method: "GET",
        path: "/faif/ibge",
        description: "Busca metadados de pesquisas do IBGE a partir de um termo.",
        params: [{ name: "q", in: "query", type: "string", example: "pib", required: true }],
        responseSample: { ok: true, data: { items: [{ id: "string", nome: "string", apelido: "string", periodicidade: "string", assunto: [] }] } },
        errorSample: { ok: false, error: { code: "IBGE_NOT_FOUND", message: "Nenhum resultado encontrado no IBGE.", details: "..." } }
      },
    ]
  },
  {
    groupName: 'Portal de Serviços',
    routes: [
      {
        utilidade: "Consulta de Órgão",
        method: "GET",
        path: "/faif/servicos/orgao/{cod_siorg}",
        description: "Consulta dados de um órgão público pelo código SIORG.",
        params: [{ name: "cod_siorg", in: "path", type: "string", example: "24", required: true }],
        responseSample: { ok: true, data: { id: "string", nome: "string", sigla: "string", conteudo: "string", url: "string" } },
        errorSample: { ok: false, error: { code: "SIORG_NOT_FOUND", message: "Código SIORG não encontrado.", details: "..." } }
      },
      {
        utilidade: "Consulta de Serviço",
        method: "GET",
        path: "/faif/servicos/servico/{cod_servico}",
        description: "Consulta dados de um serviço público específico.",
        params: [{ name: "cod_servico", in: "path", type: "string", example: "obter-o-passaporte", required: true }],
        responseSample: { ok: true, data: { id: "string", nome: "string", descricao: "string", orgao: { id: "string", nome: "string" }, etapas: [] } },
        errorSample: { ok: false, error: { code: "SERVICO_NOT_FOUND", message: "Código do serviço não encontrado.", details: "..." } }
      }
    ]
  },
  {
    groupName: 'Portal da Transparência',
    routes: [
      {
        utilidade: "Pessoa Física (CPF & NIS)",
        method: "GET",
        path: "/faif/transparencia/pessoa-fisica/{cpf}/{nis}",
        description: "Consulta dados de uma pessoa física. Requer autenticação.",
        headers: [{ name: 'chave-api-dados', required: true }],
        params: [
          { name: "cpf", in: "path", type: "string", example: "11122233344", required: true },
          { name: "nis", in: "path", type: "string", example: "55566677788", required: true }
        ],
        responseSample: { ok: true, data: [{ id: 0, pessoa: { cpfFormatado: "string", nis: "string", nome: "string" }, informacoesAdicionais: "string" }] },
        errorSample: { ok: false, error: { code: "PESSOA_FISICA_NOT_FOUND", message: "Pessoa física não encontrada.", details: "..." } }
      },
      {
        utilidade: "Busca de Servidores",
        method: "GET",
        path: "/faif/transparencia/servidores",
        description: "Busca servidores públicos por nome. Requer autenticação.",
        headers: [{ name: 'chave-api-dados', required: true }],
        params: [
          { name: "nome", in: "query", type: "string", example: "Joao Silva", required: true },
          { name: "pagina", in: "query", type: "integer", example: "1", required: false }
        ],
        responseSample: { ok: true, data: [{ id: 0, nome: "string", cpfFormatado: "string", vinculo: "string", orgaoLotacao: "string" }] },
        errorSample: { ok: false, error: { code: "SERVIDOR_NOT_FOUND", message: "Nenhum servidor encontrado para este nome.", details: "nome=Joao Silva" } }
      },
      {
        utilidade: "Busca de Emendas",
        method: "GET",
        path: "/faif/transparencia/emendas/{page}",
        description: "Busca emendas parlamentares com filtros. Requer autenticação.",
        headers: [{ name: 'chave-api-dados', required: true }],
        params: [
          { name: "page", in: "path", type: "integer", example: "1", required: true },
          { name: "ano", in: "query", type: "integer", example: "2025", required: false },
          { name: "nomeAutor", in: "query", type: "string", example: "Maria", required: false }
        ],
        responseSample: { ok: true, data: [{ ano: "string", autor: "string", codigoEmenda: "string", localidadeDoGasto: "string", numeroEmenda: "string", tipoEmenda: "string", valorEmpenhado: "string", valorLiquidado: "string", valorPago: "string" }] },
        errorSample: { ok: false, error: { code: "INVALID_PAGE", message: "Parâmetro 'page' deve ser inteiro >= 1.", details: { page: "zero" } } }
      }
    ]
  }
];

// ===================================================================================
//  LÓGICA DA PÁGINA
//  Código responsável pela interatividade e renderização.
// ===================================================================================

document.addEventListener('DOMContentLoaded', () => {
  const routesListEl = document.getElementById('routesList');
  let flatRoutes = [];

  API_ENDPOINTS.forEach(group => {
    const header = document.createElement('div');
    header.className = 'group-header';
    header.textContent = group.groupName;
    routesListEl.appendChild(header);
    
    group.routes.forEach(route => {
      const routeIndex = flatRoutes.length;
      flatRoutes.push(route);

      const item = document.createElement('a');
      item.href = '#';
      item.className = 'list-group-item list-group-item-action route-item';
      item.dataset.index = routeIndex;
      item.innerHTML = `
        <div class="d-flex w-100 justify-content-between">
          <strong class="mb-1">${route.utilidade}</strong>
          <span class="method-get">${route.method}</span>
        </div>
        <small class="text-white-50 text-break">${route.path}</small>
      `;
      item.addEventListener('click', (e) => {
        e.preventDefault();
        selectRoute(routeIndex);
      });
      routesListEl.appendChild(item);
    });
  });

  const headersStore = {};
  let currentIndex = 0;

  function selectRoute(idx) {
    const route = flatRoutes[idx];
    if (!route) return;
    currentIndex = idx;

    document.getElementById('panelEndpoint').textContent = route.path;
    document.getElementById('endpointDescription').textContent = route.description;
    
    const mb = document.getElementById('methodBadge');
    mb.textContent = route.method;
    mb.className = `method-get`; // Apenas GET por enquanto

    // Required headers hint
    const requiredHeadersEl = document.getElementById('requiredHeaders');
    if (route.headers && route.headers.length > 0) {
        const required = route.headers.filter(h => h.required).map(h => `<code>${h.name}</code>`).join(', ');
        if (required) {
            requiredHeadersEl.innerHTML = `<strong>Header Obrigatório:</strong> ${required}. Adicione na seção "Headers Customizados".`;
            requiredHeadersEl.style.display = 'block';
        }
    } else {
        requiredHeadersEl.style.display = 'none';
    }

    // Build parameter inputs
    const acc = document.getElementById('paramAccordion');
    acc.innerHTML = '';
    if (!route.params || route.params.length === 0) {
      acc.innerHTML = `<div class="small text-white-50 p-2">Sem parâmetros de rota.</div>`;
    } else {
      route.params.forEach((p, i) => {
        const inputId = `param-input-${idx}-${i}`;
        const isRequired = p.required ? ' <span class="text-danger">*</span>' : '';
        const accordionItem = document.createElement('div');
        accordionItem.className = 'accordion-item bg-dark border-secondary';
        accordionItem.innerHTML = `
          <h2 class="accordion-header">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-${idx}-${i}">
              <span class="param-type me-3">${p.in}</span>
              <strong>${p.name}${isRequired}</strong>
            </button>
          </h2>
          <div id="collapse-${idx}-${i}" class="accordion-collapse collapse" data-bs-parent="#paramAccordion">
            <div class="accordion-body">
              <div class="small text-white-50 mb-2">Tipo: <code>${p.type}</code></div>
              <input type="text" class="form-control form-control-sm bg-dark text-white" id="${inputId}" data-param-name="${p.name}" data-param-in="${p.in}" placeholder="Ex: ${p.example || ''}">
            </div>
          </div>
        `;
        acc.appendChild(accordionItem);
      });
    }
    
    document.getElementById('responseJson').textContent = JSON.stringify(flatRoutes[currentIndex].responseSample, null, 2);
    buildCurlSample();
  }

  function buildCurlSample() {
    const route = flatRoutes[currentIndex];
    let path = route.path;
    const queryParams = [];
    
    document.querySelectorAll('#paramAccordion input').forEach(input => {
      const { paramName, paramIn } = input.dataset;
      const value = input.value.trim() || input.placeholder.replace('Ex: ', '');

      if (paramIn === 'path') {
        path = path.replace(`{${paramName}}`, encodeURIComponent(value));
      } else if (paramIn === 'query') {
        queryParams.push(`${encodeURIComponent(paramName)}=${encodeURIComponent(value)}`);
      }
    });
    
    const finalUrl = BASE_URL + path + (queryParams.length > 0 ? `?${queryParams.join('&')}` : '');
    
    let headersPart = '';
    for (const key in headersStore) {
        headersPart += ` \\\n     -H "${key}: ${headersStore[key]}"`;
    }

    document.getElementById('curlSample').textContent = `curl -X ${route.method}${headersPart} \\\n     "${finalUrl}"`;
  }

  document.getElementById('tryBtn').addEventListener('click', async () => {
    const route = flatRoutes[currentIndex];
    let path = route.path;
    const queryParams = [];
    let validationError = false;

    document.querySelectorAll('#paramAccordion input').forEach(input => {
        const { paramName, paramIn } = input.dataset;
        const value = input.value.trim();
        const paramDef = route.params.find(p => p.name === paramName);

        if (paramDef.required && !value) {
            alert(`Parâmetro obrigatório "${paramName}" não foi preenchido.`);
            validationError = true;
            return;
        }

        if (paramIn === 'path') {
            path = path.replace(`{${paramName}}`, encodeURIComponent(value || paramDef.example));
        } else if (paramIn === 'query' && value) {
            queryParams.push(`${encodeURIComponent(paramName)}=${encodeURIComponent(value)}`);
        }
    });

    if (validationError) return;

    const finalUrl = BASE_URL + path + (queryParams.length > 0 ? `?${queryParams.join('&')}` : '');
    const headers = new Headers({ 'Accept': 'application/json', ...headersStore });

    const metaEl = document.getElementById('meta');
    const statusBadgeEl = document.getElementById('statusBadge');
    const responseJsonEl = document.getElementById('responseJson');
    statusBadgeEl.innerHTML = '<span class="badge bg-info">Requesting...</span>';
    
    try {
      const t0 = performance.now();
      const response = await fetch(finalUrl, { method: route.method, headers });
      const t1 = performance.now();
      metaEl.textContent = `Status: ${response.status} ${response.statusText} | Time: ${Math.round(t1 - t0)} ms`;

      const data = await response.json();
      responseJsonEl.textContent = JSON.stringify(data, null, 2);
      statusBadgeEl.innerHTML = `<span class="badge ${response.ok ? 'bg-success' : 'bg-warning text-dark'}">${response.status}</span>`;
    } catch (error) {
      metaEl.textContent = `Status: Network Error`;
      responseJsonEl.textContent = `Erro na requisição. Verifique o console (F12) para detalhes de CORS ou problemas de rede.\n\n${error}`;
      statusBadgeEl.innerHTML = '<span class="badge bg-danger">FAIL</span>';
    }
  });

  // Headers management
  document.getElementById('addHeaderBtn').addEventListener('click', () => {
    const keyEl = document.getElementById('authHeaderKey');
    const valEl = document.getElementById('authHeaderValue');
    const key = keyEl.value.trim();
    const val = valEl.value.trim();
    if (key && val) {
        headersStore[key] = val;
        keyEl.value = '';
        valEl.value = '';
        renderHeaders();
        buildCurlSample();
    }
  });

  function renderHeaders() {
      const listEl = document.getElementById('customHeadersList');
      listEl.innerHTML = '';
      Object.entries(headersStore).forEach(([key, value]) => {
          const item = document.createElement('div');
          item.className = 'd-flex justify-content-between align-items-center my-1';
          item.innerHTML = `<code>${key}: ${value}</code>`;
          const removeBtn = document.createElement('button');
          removeBtn.className = 'btn-close btn-close-white ms-2';
          removeBtn.style.height = '0.5em';
          removeBtn.style.width = '0.5em';
          removeBtn.onclick = () => {
              delete headersStore[key];
              renderHeaders();
              buildCurlSample();
          };
          item.appendChild(removeBtn);
          listEl.appendChild(item);
      });
  }
  
  // Initial setup
  document.querySelectorAll('#paramAccordion, #interactionPanel').forEach(el => el.addEventListener('input', buildCurlSample));
  selectRoute(0);
});
</script>
</body>
</html>